## Resources Requirements and Limits

ê¸°ë³¸ì ìœ¼ë¡œ KubernetesëŠ” **0.5 CPU** ë° **256 Mi** ë©”ëª¨ë¦¬ë¥¼ ì œê³µí•©ë‹ˆë‹¤. ì´ë¥¼ ì»¨í…Œì´ë„ˆì— ëŒ€í•œ Resources Requirementsë¼ê³  í•©ë‹ˆë‹¤.

Modification in resource requirements are provided in **pod-definition.yml:**

```yaml
apiVersion: v1 # version of Kubernetes API
kind: Pod # kind of Kubernetes object to be created
metadata: # data about the Kubernetes object `kind`
  name: myapp-pod
  labels:
    app: myapp
    type: front-end
    env: test
spec: # specification about Kubernetes object `kind`
  containers:
    - name: nginx-container
      image: nginx
  nodeName: # by default is empty
  tolerations:
    - key: "app"
      operator: "Equal"
      value: "blue"
      effect: "NoSchedule" 
  affinity:
    nodeAffinity:
      requiredDuringSchedulingIgnoredDuringExecution:
        nodeSelectorTerms:
        - matchExpressions:
          - key: size
            operator: In
            values:
            - Large
  nodeSelector:
    size: Large
  resources:				ğŸ‘ˆ
    requests:
      memory: "1Gi"
      cpu: 1
  limits:
    memory: "2Gi"
    cpu: 2
    
  schedulerName: my-custom-scheduler
```



**CPU ìˆ˜**ëŠ” 0.1(100m) ë˜ëŠ” 1m ì •ë„ë¡œ ë‚®ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

1 CPU count = 1 AWS vCPU = 1 GCP Core = 1 Azure Core = 1 Hyperthread


 **Memory Count:**

 ```
1 G/Gigabyte = 1000000000 bytes
1 M/Megabyte = 1000000 bytes
1 K/Kilobyte = 1000 bytes

1 Gi/Gibibyte = 1,073,741,824 bytes
1 Mi/Mebibyte = 1,048,576 bytes
1 Ki/Kibibyte = 1,024 bytes
 ```

### Resource Limits

ê¸°ë³¸ì ìœ¼ë¡œ Kubernetesì—ëŠ” 1 vCPU ë° 512 Mi ë©”ëª¨ë¦¬ ì œí•œì´ ìˆìŠµë‹ˆë‹¤.


ë³€ê²½í•˜ë ¤ë©´ **pod-definition.yml**ì— ì–¸ê¸‰í•˜ë©´ ë©ë‹ˆë‹¤.

```yaml
apiVersion: v1 # version of Kubernetes API
kind: Pod # kind of Kubernetes object to be created
metadata: # data about the Kubernetes object `kind`
  name: myapp-pod
  labels:
    app: myapp
    type: front-end
    env: test
spec: # specification about Kubernetes object `kind`
  containers:
    - name: nginx-container
      image: nginx
  nodeName: # by default is empty
  tolerations:
    - key: "app"
      operator: "Equal"
      value: "blue"
      effect: "NoSchedule" 
  affinity:
    nodeAffinity:
      requiredDuringSchedulingIgnoredDuringExecution:
        nodeSelectorTerms:
        - matchExpressions:
          - key: size
            operator: In
            values:
            - Large
  nodeSelector:
    size: Large
  resources:
    requests:
      memory: "1Gi"
      cpu: 1
  limits:				ğŸ‘ˆ
    memory: "2Gi"
    cpu: 2
    
  schedulerName: my-custom-scheduler
```

í¬ë“œê°€ CPU ì‚¬ìš©ëŸ‰ í•œë„ë¥¼ ì´ˆê³¼í•˜ë ¤ê³  í•˜ë©´ ë…¸ë“œê°€ ì œí•œë˜ì§€ë§Œ ê³¼ë„í•œ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ì€ ê·¸ë ‡ì§€ ì•ŠìŠµë‹ˆë‹¤.

ì´ê²ƒì€ ë©”ëª¨ë¦¬ì˜ ê²½ìš°ê°€ ì•„ë‹™ë‹ˆë‹¤. í¬ë“œëŠ” ë©”ëª¨ë¦¬ ì œí•œì„ ì´ˆê³¼í•  ìˆ˜ ìˆì§€ë§Œ ì§€ì†ì ìœ¼ë¡œ ê³¼ë„í•œ ë©”ëª¨ë¦¬ë¥¼ ì‚¬ìš©í•˜ë©´ ì¢…ë£Œë©ë‹ˆë‹¤.

### Limit Range

> í¬ë“œê°€ ìƒì„±ë˜ë©´ ì»¨í…Œì´ë„ˆì— ê¸°ë³¸ CPU ìš”ì²­ .5ì™€ ë©”ëª¨ë¦¬ 256Miê°€ í• ë‹¹ë©ë‹ˆë‹¤.

PODê°€ ì´ëŸ¬í•œ ê¸°ë³¸ê°’ì„ ì„ íƒí•˜ë ¤ë©´ ë¨¼ì € í•´ë‹¹ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ì— LimitRangeë¥¼ ìƒì„±í•˜ì—¬ ìš”ì²­ ë° ì œí•œì— ëŒ€í•œ ê¸°ë³¸ê°’ìœ¼ë¡œ ì„¤ì •í•´ì•¼ í•©ë‹ˆë‹¤. 

 ```yaml
apiVersion: v1
kind: LimitRange
metadata: 
  name: mem-cpu-limit-range
spec:
  limits:
  - default:
      memory: 512Mi
      cpu: 1
    defaultRequest:
      memory: 256Mi
      cpu: 0.5
    type: Container
 ```



#### A quick note on editing PODs and Deployments

##### Edit a POD

ì•„ë˜ ë‚˜ì—´ëœ ê¸°ì¡´ PODì˜ ì‚¬ì–‘ë§Œ í¸ì§‘í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

1. `spec.containers[*].image`

2. `spec.initContainers[*].image`

3. `spec.activeDeadlineSeconds`

4. `spec.tolerations`

##### Edit Deployments

ë°°í¬ë¥¼ ì‚¬ìš©í•˜ë©´ POD í…œí”Œë¦¿ì˜ ëª¨ë“  í•„ë“œ/ì†ì„±ì„ ì‰½ê²Œ í¸ì§‘í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. í¬ë“œ í…œí”Œë¦¿ì€ ë°°í¬ ì‚¬ì–‘ì˜ í•˜ìœ„ í•­ëª©ì´ë¯€ë¡œ ë³€ê²½ ì‚¬í•­ì´ ìˆì„ ë•Œë§ˆë‹¤ ë°°í¬ê°€ ìë™ìœ¼ë¡œ ì‚­ì œë˜ê³  ìƒˆ ë³€ê²½ ì‚¬í•­ì´ í¬í•¨ëœ ìƒˆ í¬ë“œê°€ ìƒì„±ë©ë‹ˆë‹¤. ë”°ë¼ì„œ ë°°í¬ì˜ POD ë¶€ë¶„ ì†ì„±ì„ í¸ì§‘í•˜ë¼ëŠ” ë©”ì‹œì§€ê°€ í‘œì‹œë˜ë©´ ë‹¤ìŒ ëª…ë ¹ì„ ì‹¤í–‰í•˜ì—¬ ê°„ë‹¨íˆ ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```powershell
kubectl edit deployment my-deployment
```

## Daemon Sets

DaemonSetëŠ” ëª¨ë“ (ë˜ëŠ” ì¼ë¶€) ë…¸ë“œê°€ Podì˜ ë³µì‚¬ë³¸ì„ ì‹¤í–‰í•˜ë„ë¡ í•©ë‹ˆë‹¤. ë…¸ë“œê°€ í´ëŸ¬ìŠ¤í„°ì— ì¶”ê°€ë˜ë©´ Podê°€ ì—¬ê¸°ì— ì¶”ê°€ë©ë‹ˆë‹¤. í´ëŸ¬ìŠ¤í„°ì—ì„œ ë…¸ë“œê°€ ì œê±°ë˜ë©´ í•´ë‹¹ í¬ë“œëŠ” ê°€ë¹„ì§€ ìˆ˜ì§‘ë©ë‹ˆë‹¤. DaemonSetë¥¼ ì‚­ì œí•˜ë©´ ìƒì„±ëœ Podê°€ ì •ë¦¬ë©ë‹ˆë‹¤.

DaemonSetì˜ ì¼ë°˜ì ì¸ ìš©ë„ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

- ëª¨ë“  ë…¸ë“œì—ì„œ í´ëŸ¬ìŠ¤í„° ì €ì¥ì†Œ ë°ëª¬ ì‹¤í–‰

- ëª¨ë“  ë…¸ë“œì—ì„œ ë¡œê·¸ ìˆ˜ì§‘ ë°ëª¬ ì‹¤í–‰

- ëª¨ë“  ë…¸ë“œì—ì„œ ë…¸ë“œ ëª¨ë‹ˆí„°ë§ ë°ëª¬ ì‹¤í–‰

 ë…¸ë“œì—ì„œ í¬ë“œë¥¼ ì˜ˆì•½í•˜ê¸° ìœ„í•´ `NodeAffinity`ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.

 ![](https://raw.githubusercontent.com/aditya109/learning-k8s/main/Core%20Concepts/assets/image21.svg)

 ```yaml
apiVersion: apps/v1
kind: DaemonSet
metadata:
  name: monitoring-daemon
spec:
  containers:
  - name: monitoring-agent
    image: monitoring-agent
  selector: 
    matchLabels:
      app: monitoring-agent
  template:
    metadata:
      labels:
        app: monitoring-agent
 ```

Commands:

To get daemon sets: `kubectl get daemonsets`
To describe daemonsets: `kubectl describe daemonsets monitoring-daemon`

## Static Pods

Static PodëŠ” API ì„œë²„ê°€ ê´€ì°°í•˜ì§€ ì•Šê³  íŠ¹ì • ë…¸ë“œì˜ kubelet ë°ëª¬ì— ì˜í•´ ì§ì ‘ ê´€ë¦¬ë©ë‹ˆë‹¤. ì»¨íŠ¸ë¡¤ í”Œë ˆì¸(ì˜ˆ: ë°°í¬)ì—ì„œ ê´€ë¦¬í•˜ëŠ” í¬ë“œì™€ ë‹¬ë¦¬ ëŒ€ì‹  kubeletì€ ê° ì •ì  Podë¥¼ ê°ì‹œí•˜ê³  ì‹¤íŒ¨í•˜ë©´ ë‹¤ì‹œ ì‹œì‘í•©ë‹ˆë‹¤.

ì •ì  í¬ë“œëŠ” í•­ìƒ íŠ¹ì • ë…¸ë“œì—ì„œ í•˜ë‚˜ì˜ Kubeletì— ë°”ì¸ë”©ë©ë‹ˆë‹¤.

kubeletì€ ìë™ìœ¼ë¡œ ê° ì •ì  Podì— ëŒ€í•´ Kubernetes API ì„œë²„ì— ë¯¸ëŸ¬ Podë¥¼ ìƒì„±í•˜ë ¤ê³  ì‹œë„í•©ë‹ˆë‹¤. ì¦‰, ë…¸ë“œì—ì„œ ì‹¤í–‰ ì¤‘ì¸ í¬ë“œëŠ” API ì„œë²„ì—ì„œ ë³¼ ìˆ˜ ìˆì§€ë§Œ ì œì–´í•  ìˆ˜ëŠ” ì—†ìŠµë‹ˆë‹¤.

ë‹¨ì¼ ë…¸ë“œì—ëŠ” kubeletì´ ì£¼ê¸°ì ìœ¼ë¡œ í™•ì¸í•˜ëŠ” `/etc/kubernetes/manifests`ì—ì„œ pod-manifestë¼ëŠ” ìœ„ì¹˜ê°€ ìˆìœ¼ë©°, podë¥¼ ì •ì  podë¡œ ìƒì„±í•©ë‹ˆë‹¤(kubeletì—ì„œëŠ” podë§Œ ìƒì„±í•  ìˆ˜ ìˆìŒ). `kubeconfig.yaml`ì„ ì œê³µí•˜ì—¬ `kubelet.service`ì—ì„œ ë³€ê²½í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì´ëŸ¬í•œ yamlì´ ë³€ê²½ë˜ë©´ podê°€ ë‹¤ì‹œ ìƒì„±ë˜ê³  ì´ëŸ¬í•œ ë§¤ë‹ˆí˜ìŠ¤íŠ¸ë¥¼ ì œê±°í•˜ë©´ ê¸°ì¡´ ì •ì  podê°€ ì‚­ì œë©ë‹ˆë‹¤.

ì •ì  í¬ë“œë¥¼ í™•ì¸í•˜ë ¤ë©´(kube-apiserver ì‚¬ìš©): `kubectl get pods`
ì •ì  í¬ë“œë¥¼ í™•ì¸í•˜ë ¤ë©´(kube-apiserver ì—†ì´ kubeletë§Œ ì‚¬ìš©: `docker ps`
pod-manifests-directory ìœ„ì¹˜ë¥¼ ì–»ìœ¼ë ¤ë©´: `ps -ef | grep kubelet | grep "\--config"`

| Static PODs                                     | DaemonSets                                            |
| ----------------------------------------------- | ----------------------------------------------------- |
| Kubeletì— ì˜í•´ ìƒì„±                              | kube-apiserverì— ì˜í•´ ìƒì„±ë¨(DaemonSet ì»¨íŠ¸ë¡¤ëŸ¬ë¥¼ í†µí•´) |
| ì»¨íŠ¸ë¡¤ í”Œë ˆì¸ êµ¬ì„± ìš”ì†Œë¥¼ ì •ì  í¬ë“œë¡œ ë°°í¬         | ë…¸ë“œì— ëª¨ë‹ˆí„°ë§ ì—ì´ì „íŠ¸, ë¡œê¹… ì—ì´ì „íŠ¸ ë°°í¬             |
| Kube-Schedulerì—ì„œ ë¬´ì‹œë¨                        |                                                       |


 ì •ì  Podë¡œ ì‹œì‘í•˜ëŠ” ë‹¨ê³„:

1. ì •ì  Podë¥¼ ì‹¤í–‰í•  ë…¸ë“œë¥¼ ì„ íƒí•©ë‹ˆë‹¤.
   `ssh my-node1`

2. **/etc/kubelet.d**ì™€ ê°™ì€ ë””ë ‰í„°ë¦¬ë¥¼ ì„ íƒí•˜ê³  ì—¬ê¸°ì— ì›¹ ì„œë²„ í¬ë“œ ì •ì˜ë¥¼ ë°°ì¹˜í•©ë‹ˆë‹¤(ì˜ˆ: **/etc/kubectl.d/static-web.yaml**).

 kubeletì´ ì‹¤í–‰ ì¤‘ì¸ ë…¸ë“œì—ì„œ ì´ ëª…ë ¹ì„ ì‹¤í–‰í•©ë‹ˆë‹¤.

```bash
mkdir /etc/kubelet.d/
cat /etc/kubelet.d/static-web.yaml
apiVersion: v1
kind: Pod
metadata:
  name: static-web
  labels:
    role: myrole
spec:
  containers:
    - name: web
      image: nginx
      ports:
        - name: web
          containerPort: 80
          protocol: TCP
```

3.**--pod-manifest-path=/etc/kubelet.d/manifest**ì™€ í•¨ê»˜ ì‹¤í–‰í•˜ì—¬ ì´ ë””ë ‰í„°ë¦¬ë¥¼ ì‚¬ìš©í•˜ë„ë¡ ë…¸ë“œì—ì„œ kubeletì„ êµ¬ì„±í•©ë‹ˆë‹¤.

   ```sh
   KUBELET_ARGS="--cluster-dns=10.254.0.10 --cluster-domain=kube.local --pod-manifest-path=/etc/kubelet.d/"
   ```

   kubelet êµ¬ì„± íŒŒì¼ì— **<staticPodPath: <the-directory>** í•„ë“œë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤.

4. kubelet ì¬ì‹œì‘: `systemctl restart kubelet`
